<!DOCTYPE html>
<html lang="ch" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>YoungTube-视频投稿</title>
    <script th:src="@{/common/js/jquery-3.3.1.js}"></script>
    <link rel="stylesheet" th:href="@{/notcommon/Homepage/mycssAndimg/css.css}">

    <link rel="stylesheet" th:href="@{/notcommon/videoUpLoad/css/tag.css}">
    <script th:src="@{/notcommon/videoUpLoad/js/input_box.js}"></script>


</head>
<style>

</style>
<body style="background-image: url(/static/notcommon/Homepage/mycssAndimg/timg.jpg);">
<div id="none">
    <!-- style="width: 100%;height: 60px;background-color: white;" -->
</div>

<div>

    <div>

        <form id="upload_form">

            <div>
                <div><label for="image_file" style="color: wheat;">请选择投稿视频文件</label></div>
                <div><input type="file" name="videoFiles" id="videoFiles" /></div>
            </div>
            <div>
                <div><label for="image_file" style="color: wheat;">请选择投稿封面壁纸</label></div>
                <div><input type="file" name="videoFiles" id="videoFront" /></div>
            </div>
            <div>
                <div><label for="image_file" style="color: wheat;">请输入视频标题</label></div>
                <div><input type="text" name="videoName"  id="videoName" /></div>
            </div>

            <div>
                <div><label for="image_file" style="color: wheat;">请输入视频描述</label></div>
                <div><textarea  rows="13" name="videoIntroduction" id="videoIntroduction" cols="70"></textarea></div>
            </div>

            <div>
                <div><label for="image_file" style="color: wheat;">请选择投放区域</label></div>
                <div>
                    <label th:each="category:${categorys}">
                        <input name="videoCategory" type="radio" th:value="${category.categoryId}"/>[[${category.categoryName}]]
                    </label>
                </div>
            </div>

            <div>
                <div><label for="image_file" style="color: wheat;">请添加标签</label></div>
                <ul id="input_box">
                    <!-- <li class="xm-select-label"><span fsw="xm-select" value="选项 1"><font fsw="xm-select">选项1</font><i fsw="xm-select" class="xm-iconfont icon-close"></i></span></li>-->

                    <li class="input_box xm-select-label"><input type="text" name="set_text" id="set_text" value="" /></li>
                    <input hidden type="text" name="tagName"  id="tagName" />
                </ul>
            </div>

            <div>
                <input type="button" value="立即投稿" id="tougao" />  <input type="button" id="fanhui" value="返回主页" />
            </div>
        </form>
        <div style="display: none;" id="daxiaobuneng"><b style="color: red;">总大小不能超过1g</b></div>





    </div>
    <script type="text/javascript">
        $("#fanhui").click(function(){
            location.href = "/pages/toIndex";
        })

    </script>

    <script>
        $("#tougao").click(function(){
            //判断视频
            var video = $("#videoFiles").val();
            if(video == "") {
                alert("请上传投稿的视频");
                return false;
            } else {
                if(!/\.(mp4)$/.test(video)) {
                    alert("视频格式必须为.MP4格式")
                    return false;
                }
                //判断图片
                var videoFront = $("#videoFront").val();
                if(videoFront == "") {
                    alert("请选择图片");
                    return false;
                } else {
                    if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(videoFront)) {
                        alert("图片类型必须是.gif,jpeg,jpg,png中的一种")
                        return false;
                    }
                }
                //开始判断输入的内容
                var videoName = $("#videoName").val();
                var videoIntroduction = $("#videoIntroduction").val();
                if(videoName == "" || videoIntroduction == "" || videoIntroduction == "null" || videoName == "null") {
                    alert("请正确输入标题和描述");
                    return false;
                }
                //判断文件总大小 不能超1g
                //用户上传的视频
                var files =$("#videoFiles").prop('files');
                var fileSize=0;
                for(var i=0;i<files.length;i++){
                    fileSize=$(files)[i].size;
                }
                //用户上传的图片
                var addImags =$("#videoFront").prop('files');
                var fileSize2=0;
                for(var i=0;i<addImags.length;i++){
                    fileSize2=$(addImags)[i].size;
                }

                var totalSize = fileSize+fileSize2;
                var Maxzong = 1073741824;
                if(totalSize>Maxzong){
                    $("#daxiaobuneng").show();
                    alert("对不起 文件过大.无法上传");
                    return false;
                }

            }
            //判断结束
            $("#tougao").attr('disabled',true); //将button变成不可点击
            var formData = new FormData($( "#upload_form" )[0]);
            alert(window.tagName);
            $.ajax({
                url: '/video/videoUpload' ,
                type: 'POST',
                // data: {"formData":formData,"tagName":window.tagName},
                data: formData,
                async: true,  //设置为同步
                cache: false,
                contentType: false,
                processData: false,
                success: function (returndata) {
                    alert("上传成功");
                    location.reload();

                    //$("#tougao").attr('disabled',false); //将button变成可点击
                },
                error: function (returndata) {
                    alert("上传失败");
                }
            });
            $(function (){
                //iCount获取setInterval句柄
                var iCount = setInterval(GetBack, 100);
                function GetBack() {
                    var html = "";
                    $.post("/check/percentAJAX", function(r) {
                        //把json字符串转换为json对象
                        var obj = eval("(" + r + ")");
                        //alert(obj.test);
                        var a=obj.percent;
                        a += 1;
                        //得到DIV
                        html += "<div id='none2' style='width: "+a+"%;height: 60px;background-color: blue;'>";
                        html += "<h1>"+a+"%</h1>";
                        html += "</div>";
                        //alert(html);
                        $("#none").html(html);
                        html="";
                        //如果标记不为 0  表示上传完成
                        if (obj.tag != 0) {
                            //alert("进入");
                            //清除setInterval
                            clearInterval(iCount);
                        }
                    });
                }
            });
        });


    </script>
    <!--         要想获取某个radio的值有以下的几种方法,直接给出代码：
    1、
    1.$('input[name="testradio"]:checked').val();2、
    1.$('input:radio:checked').val();3、
    1.$('input[@name="testradio"][checked]');4、
    1.$('input[name="testradio"]').filter(':checked');差不多挺全的了，如果我们要遍历name为testradio的所有radio呢，代码如下
    1.$('input[name="testradio"]').each(function(){2.alert(this.value);3.});如果要取具体某个radio的值，比如第二个radio的值，这样写
    1.$('input[name="testradio"]:eq(1)').val() -->
</div>

<script>
    $(function() {
        $("#input_box").contentbox({
            elm: "#set_text",
            callback: function(e) {
                // alert(e);
                $("#tagName").val($("#tagName").val()+e.toString()+" ");

                /*$.ajax({
                    url: '/video/videoUpload' ,
                    type: 'POST',
                    data: JSON.stringify(e),
                    async: true,  //设置为同步
                    success: function () {
                        alert("添加标签成功!");
                        //location.reload();
                    },
                    error: function () {
                        alert("添加标签失败!");
                    }
                });
*/
            }

        })


    })
</script>

</body>



</html>